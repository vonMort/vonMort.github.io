<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WoT ‚Äì Neutral Questionnaire & Recommendation</title>
    <style>
        :root{
            --bg:#0b0f14;--fg:#e7eef7;--muted:#9fb3c8;--card:#121822;--accent:#77c0ff;--ok:#6ad36a;--no:#ff6b6b;
        }
        *{box-sizing:border-box}
        html,body{height:100%;}
        body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;line-height:1.45;background:var(--bg);color:var(--fg)}
        .container{max-width:980px;margin:0 auto;padding:24px}
        header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:16px}
        h1{font-size:clamp(20px,2.6vw,28px);margin:0}
        .card{background:var(--card);border:1px solid #1d2633;border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
        .grid{display:grid;gap:16px}
        .two{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
        .section-title{margin:10px 0 6px;font-size:18px;color:var(--accent)}
        .q{display:flex;align-items:center;justify-content:space-between;background:#0e1520;border:1px solid #233045;border-radius:12px;padding:10px 12px;margin:8px 0}
        .q label{display:block;font-size:15px;color:var(--fg);}
        .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
        button{appearance:none;border:1px solid #2b3a50;background:#132033;color:var(--fg);padding:9px 12px;border-radius:10px;font-weight:600;cursor:pointer}
        button.primary{background:linear-gradient(180deg,#1e4266,#14324f);border-color:#1b3d5a}
        button:disabled{opacity:.5;cursor:not-allowed}
        .pill{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;border:1px solid #2b3a50;background:#0f1a28;color:var(--muted);font-size:12px}
        .recommendation{border-left:4px solid var(--accent);padding-left:12px;margin:10px 0}
        .rec-title{font-weight:700;font-size:16px}
        .bullets{margin:8px 0 0 16px}
        .bullets li{margin:4px 0}
        details{background:#0e1520;border:1px solid #1f2a3a;border-radius:10px;padding:8px 10px}
        summary{cursor:pointer;color:var(--muted)}
        footer{margin-top:20px;color:var(--muted);font-size:12px}
        .yesno{display:flex;gap:8px}
        .yesno input{display:none}
        .yesno label{padding:6px 10px;border:1px solid #2b3a50;border-radius:8px;cursor:pointer;background:#0f1a28}
        .yesno input:checked + label{border-color:#2f82ff;background:#11233a}
        .yesno input[value="yes"]:checked + label{outline:2px solid rgba(106,211,106,.35)}
        .yesno input[value="no"]:checked + label{outline:2px solid rgba(255,107,107,.35)}
        .tag{font-size:11px;color:#c7d8eb}
        .muted{color:var(--muted)}
        .lang-switch{display:inline-flex;gap:6px}
        .flag-btn{border:1px solid #2b3a50;background:#0f1a28;color:#fff;border-radius:8px;padding:6px 8px;cursor:pointer;line-height:1}
        .flag-btn:hover{background:#132033}
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1 id="appTitle">World of Tanks ‚Äì Neutral Questionnaire & Tier 10 Recommendation</h1>
        <div style="display:flex;align-items:center;gap:10px">
            <div class="pill" id="classPill">Classes considered: Light ¬∑ Medium ¬∑ Heavy ¬∑ TD ¬∑ SPG</div>
            <div class="lang-switch">
                <button class="flag-btn" id="btnLangDE" title="Deutsch" aria-label="Deutsch">üá©üá™</button>
                <button class="flag-btn" id="btnLangEN" title="English" aria-label="English">üá¨üáß</button>
            </div>
        </div>
    </header>

    <div class="card" id="intro">
        <p class="muted" id="introText">Answer 40 neutral yes/no questions. At the end you'll receive 2‚Äì3 suitable tier 10 suggestions (across classes), brief playstyle notes and a section ‚ÄúWhy not other classes?‚Äù.</p>
        <div class="actions">
            <button class="primary" id="btnStart" onclick="start()">Start questionnaire</button>
            <button id="btnDemo" onclick="demoFill()">Load sample answers</button>
            <button id="btnReset" onclick="resetAll()">Reset</button>
        </div>
    </div>

    <div class="grid two" id="formWrap" style="display:none"></div>

    <div class="card" id="result" style="display:none;margin-top:16px"></div>

    <footer>
        <p>Single‚Äëfile app.</p>
    </footer>
</div>

<script>
    const SECTIONS = {
        'A. Pace & Comfort': [
            'Do you feel more comfortable when battles start slowly?',
            'Does it bother you when a battle gives you almost no time to think?',
            'Do you enjoy when your vehicle can get to the front immediately?',
            'Is it fine with you if it takes several minutes to reach position?',
            'Do you feel safer when you have time before dealing damage?',
            'Do you enjoy being constantly on the move in battle?',
            'Does it annoy you to aim at a target for a long time before you can hit reliably?',
            'Are you fine with letting enemies come to you and waiting instead of pushing?'
        ],
        'B. Risk & Reward': [
            'Do you enjoy dumping a lot of damage quickly even if you cannot do anything for a while afterward?',
            'Do you prefer to deal steady damage over time?',
            'Would you rather land smaller reliable hits than gamble on a few big ones?',
            'Does it really bother you when a missed shot leaves you useless for a long time?',
            'Do you enjoy when a single correct play can decide victory or defeat?',
            'Do you prefer when several small actions lead to success?',
            'Are you fine with your success depending heavily on luck?',
            'Do you prefer systems that reliably behave the same way each time?'
        ],
        'C. Presence & Team Role': [
            'Do you like drawing the attention of many enemies at once?',
            'Is it fine if you are unnoticed as long as you stay effective?',
            'Do you prefer a visible, heavy role over a subtle one?',
            'Do you like when your presence basically blocks certain routes on the map?',
            'Is it important to you that your team immediately notices when you are present?',
            'Is it okay if your contribution is mostly indirect (e.g., spotting, assisting)?',
            'Do you enjoy acting as a shield for others even if you deal less damage yourself?',
            'Would you be satisfied playing mainly for your own damage even if others benefit less?'
        ],
        'D. Tolerance for Weaknesses': [
            'Are you okay with your vehicle being slow as long as it is strong?',
            'Would poor accuracy bother you a lot?',
            'Could you live with having no armor as long as you have other advantages?',
            'Does it annoy you when you often need premium ammo to penetrate?',
            'Would you enjoy driving a large vehicle even if you are always a focus target?',
            'Would it be a problem for you if you can hardly contribute once you are low on HP?',
            'Do you accept being useless in some games as long as you can carry others?',
            'Do you enjoy compensating for weaknesses with skill?'
        ],
        'E. Flexibility & Adaptation': [
            'Do you like being able to switch flanks even mid-battle?',
            'Would you be content running almost the same game plan every time?',
            'Do you love improvising when the battle gets chaotic?',
            'Do you prefer a tank that stays decent in many scenarios rather than excels in only a few?',
            'Do you enjoy adapting to changing situations even if it is hard?',
            'Is it more important to you to be extremely strong in a clear niche rather than just ok everywhere?',
            'Would you prefer a tank that works well solo regardless of team?',
            'Would you be satisfied doing little alone if you are indispensable with a team?'
        ]
    };
    const TANKS = [
        // ‚Äî USSR ‚Äî
        { id:'is7', name:'IS-7', nation:'USSR', cls:'Heavy',
            role:'durable frontline heavy, forgiving and mobile enough',
            bullets:['Sidescrape and trade with 490 alpha','Can push or hold positions','Solid all-rounder for gun marks'],
            tags:['armor_high','alpha_med','mobility_med','sustained','frontline','flex'] },
        { id:'is4', name:'IS-4', nation:'USSR', cls:'Heavy',
            role:'classic armor-blocking heavy',
            bullets:['Sidescrape and play methodically','Trade consistently','Tough but slow'],
            tags:['armor_high','sustained','mobility_low','frontline'] },
        { id:'obj277', name:'Object 277', nation:'USSR', cls:'Heavy',
            role:'fast alpha-trading heavy',
            bullets:['Aggressive openings','490 alpha with mobility','Less forgiving of mistakes'],
            tags:['alpha_med','mobility_high','flex'] },
        { id:'obj705a', name:'Object 705A', nation:'USSR', cls:'Heavy',
            role:'side-scraping brawler with high alpha',
            bullets:['Close-range trading','Strong sides for angling','Works in corridors'],
            tags:['alpha_high','armor_high','mobility_low','frontline'] },
        { id:'stii', name:'ST-II', nation:'USSR', cls:'Heavy',
            role:'dual-gun heavy with flexible firing',
            bullets:['Salvo for burst or single-fire for control','Strong armor up close','Position before committing'],
            tags:['burst','armor_high','mobility_low','frontline'] },

        { id:'obj140', name:'Object 140', nation:'USSR', cls:'Medium',
            role:'classic DPM flanker',
            bullets:['High speed and DPM','Flanking and rotations','Mistakes are punished'],
            tags:['mobility_high','sustained','glass_light','flex'] },
        { id:'obj430u', name:'Object 430U', nation:'USSR', cls:'Medium',
            role:'armored alpha medium',
            bullets:['Heavy-like but more mobile','Trades using armor','Threaten flanks'],
            tags:['armor_med','alpha_med','mobility_med','flex'] },

        { id:'obj268', name:'Object 268', nation:'USSR', cls:'TD',
            role:'assault-capable TD with punch',
            bullets:['High alpha with decent camo','Good when pushed with cover','Arc limits demand planning'],
            tags:['alpha_high','frontline','sniper'] },
        { id:'obj268v4', name:'Object 268 Version 4', nation:'USSR', cls:'TD',
            role:'assault TD with ramming potential',
            bullets:['Armor and speed','Front pressure and breakthroughs','Limited gun arc'],
            tags:['armor_high','mobility_med','frontline','alpha_med'] },

        { id:'t100lt', name:'T-100 LT', nation:'USSR', cls:'Light',
            role:'stealthy active scout',
            bullets:['Great camo and mobility','Low silhouette for active spotting','Survivability through speed'],
            tags:['mobility_high','vision','flex'] },

        { id:'obj261', name:'Object 261', nation:'USSR', cls:'SPG',
            role:'fast SPG with flat trajectory',
            bullets:['Relocate quickly','More precise than CGC','Still indirect and team-dependent'],
            tags:['arty','indirect'] },

        // ‚Äî Germany ‚Äî
        { id:'e100', name:'E 100', nation:'Germany', cls:'Heavy',
            role:'super-heavy alpha trader',
            bullets:['Force 750-alpha trades','Dominate city/corridor','Pick your position early'],
            tags:['alpha_high','armor_high','mobility_low','frontline'] },
        { id:'maus', name:'Maus', nation:'Germany', cls:'Heavy',
            role:'extreme anchor and blocker',
            bullets:['Block corridors','Use HP as a resource','Supports team but slow'],
            tags:['superheavy','armor_high','mobility_verylow','frontline'] },
        { id:'pz7', name:'Pz.Kpfw. VII', nation:'Germany', cls:'Heavy',
            role:'armored heavy for controlled trades',
            bullets:['Strong turret and angles','Works in mid-range trades','Methodical advance'],
            tags:['armor_high','sustained','frontline'] },

        { id:'e50m', name:'E 50 Ausf. M', nation:'Germany', cls:'Medium',
            role:'\"heavy-medium\" with precision and armor',
            bullets:['Angled upper plate bounces shots','Pressure and control at mid-range','Very reliable, little RNG'],
            tags:['med_heavy','sustained','mobility_med','armor_med','flex'] },
        { id:'leo1', name:'Leopard 1', nation:'Germany', cls:'Medium',
            role:'long-range DPM and map control',
            bullets:['Sniping and vision','Almost no armor','Constant repositioning'],
            tags:['mobility_high','sustained','glass','vision'] },

        { id:'grille15', name:'Grille 15', nation:'Germany', cls:'TD',
            role:'glass cannon at range',
            bullets:['High alpha and accuracy','Extremely fragile','Needs positional discipline'],
            tags:['alpha_high','glass','sniper','mobility_med'] },
        { id:'jge100', name:'Jagdpanzer E 100', nation:'Germany', cls:'TD',
            role:'super-heavy TD alpha striker',
            bullets:['17 cm hammer blows','Angle front and use cover','Slow but intimidating'],
            tags:['alpha_veryhigh','armor_high','mobility_low','frontline'] },

        { id:'rpw', name:'Rheinmetall Panzerwagen', nation:'Germany', cls:'Light',
            role:'fast wheeled-style scout without wheels',
            bullets:['High speed and view range','Direct map control via spots','Very fragile ‚Äì avoid trades'],
            tags:['mobility_high','vision','glass','flex'] },

        { id:'gwe100', name:'G.W. E 100', nation:'Germany', cls:'SPG',
            role:'high splash, sluggish',
            bullets:['Splash and stun','Very slow','Purely indirect impact'],
            tags:['arty','indirect','stationary'] },

        // ‚Äî UK ‚Äî
        { id:'sconq', name:'Super Conqueror', nation:'UK', cls:'Heavy',
            role:'hull-down sustained fire with strong gun handling',
            bullets:['Show turret, hide hull','Consistent output, little RNG','Ideal for methodical play'],
            tags:['sustained','turret_strong','mobility_low','control'] },
        { id:'fv230', name:'FV230 Canopener', nation:'UK', cls:'Heavy',
            role:'new-gen turreted heavy, hull-down enforcer',
            bullets:['Strong turret presence','Controlled pushes','Trades reliably'],
            tags:['turret_strong','sustained','frontline'] },

        { id:'centax', name:'Centurion Action X', nation:'UK', cls:'Medium',
            role:'sturdy hull-down medium',
            bullets:['Gun depression abuse','Control ridgelines','Reliable gun'],
            tags:['turret_strong','sustained','flex'] },
        { id:'concept5', name:'Concept No. 5', nation:'UK', cls:'Medium',
            role:'concept medium with strong ridge play',
            bullets:['Hold ridges','Support with accurate fire','Adaptive mid-range'],
            tags:['turret_strong','sustained','flex'] },

        { id:'badger', name:'FV217 Badger', nation:'UK', cls:'TD',
            role:'DPM fortress',
            bullets:['Face-hug and farm','Insane frontal DPM','Weak to flanks'],
            tags:['sustained','frontline','armor_high'] },
        { id:'fv4005', name:'FV4005 Stage II', nation:'UK', cls:'TD',
            role:'huge alpha glass cannon',
            bullets:['One-tap potential with HESH','Play behind cover','Punishes mistakes'],
            tags:['alpha_veryhigh','glass','sniper'] },

        { id:'manticore', name:'Manticore', nation:'UK', cls:'Light',
            role:'stealth ridge scout',
            bullets:['Exceptional camo','Spot from ridges','Low DPM ‚Äì avoid trading'],
            tags:['vision','mobility_high','glass'] },

        { id:'cgc', name:'Conqueror Gun Carriage', nation:'UK', cls:'SPG',
            role:'indirect fire with large splash zone',
            bullets:['Clear zones','Team-dependent and requires patience','Carefully select position'],
            tags:['arty','indirect','stationary'] },

        // ‚Äî France ‚Äî
        { id:'amx50b', name:'AMX 50 B', nation:'France', cls:'Heavy',
            role:'mobile clip heavy',
            bullets:['Dump 4-shot clip fast','Reposition while reloading','Punish isolated targets'],
            tags:['burst','mobility_high','flex'] },
        { id:'amxm4', name:'AMX M4 mle. 54', nation:'France', cls:'Heavy',
            role:'armored alpha-trader heavy',
            bullets:['Frontline trades','Decent armor profile','Methodical advance'],
            tags:['alpha_med','armor_high','frontline'] },

        { id:'bc25t', name:'Bat.-Ch√¢tillon 25 t', nation:'France', cls:'Medium',
            role:'high-mobility autoloader medium',
            bullets:['Clip windows & relocate','Vision control','Avoid long trades'],
            tags:['burst','mobility_high','vision','glass'] },

        { id:'fochb', name:'AMX 50 Foch B', nation:'France', cls:'TD',
            role:'autoloader TD burst',
            bullets:['Massive clip on flanks','Ambush then relocate','Needs timing discipline'],
            tags:['burst','alpha_high','mobility_med'] },

        { id:'ebrb', name:'Panhard EBR 105', nation:'France', cls:'Light',
            role:'wheeled active scout/harasser',
            bullets:['Extreme mobility','Vision and harassment','Very fragile'],
            tags:['mobility_high','vision','glass','flex'] },
        { id:'amx13105', name:'AMX 13 105', nation:'France', cls:'Light',
            role:'autoloader light',
            bullets:['Clip and run','Strong camo','Pick isolated targets'],
            tags:['burst','vision','mobility_high','glass'] },

        { id:'bat155', name:'Bat.-Ch√¢tillon 155 58', nation:'France', cls:'SPG',
            role:'mobile SPG with clip feel',
            bullets:['Arc options & stun','Relocate between shots','Indirect support'],
            tags:['arty','indirect'] },

        // ‚Äî USA ‚Äî
        { id:'t57', name:'T57 Heavy Tank', nation:'USA', cls:'Heavy',
            role:'clip heavy for close-range bursts',
            bullets:['Dump clip in brawls','Use cover during reload','Works with support'],
            tags:['burst','frontline','mobility_med'] },
        { id:'t110e5', name:'T110E5', nation:'USA', cls:'Heavy',
            role:'all-round heavy with reliable gun',
            bullets:['Hull-down when possible','Consistent trades','Flexible rotations'],
            tags:['sustained','turret_strong','flex'] },
        { id:'mvy', name:'M-V-Y', nation:'USA', cls:'Heavy',
            role:'Yoh heavy with emergency tracks',
            bullets:['Forgiving mobility from tracks','Aggressive mid-range','Solid gun handling'],
            tags:['sustained','frontline','flex'] },

        { id:'m48', name:'M48A5 Patton', nation:'USA', cls:'Medium',
            role:'vision/control medium',
            bullets:['Great view range','Ridge work & support','Reliable DPM'],
            tags:['vision','sustained','flex'] },

        { id:'t110e3', name:'T110E3', nation:'USA', cls:'TD',
            role:'armored assault TD',
            bullets:['Strong frontal armor','Corner pressure','Limited arc'],
            tags:['armor_high','frontline','alpha_med'] },
        { id:'t110e4', name:'T110E4', nation:'USA', cls:'TD',
            role:'turreted TD for trades',
            bullets:['Use turret for angles','Alpha trades then fall back','Hybrid play'],
            tags:['alpha_med','flex','frontline'] },

        { id:'sheridan', name:'XM551 Sheridan', nation:'USA', cls:'Light',
            role:'hybrid scout/harasser',
            bullets:['Good view range','Use HEAT/HE smartly','Play edges & vision'],
            tags:['vision','mobility_high','flex'] },

        { id:'t92', name:'T92 HMC', nation:'USA', cls:'SPG',
            role:'heavy splash SPG',
            bullets:['Large splash & stun','Very slow','Purely indirect'],
            tags:['arty','indirect','stationary'] },

        // ‚Äî China ‚Äî
        { id:'121', name:'121', nation:'China', cls:'Medium',
            role:'alpha-leaning medium',
            bullets:['High pen/alpha for a med','Trades at mid-range','Flank when openings arise'],
            tags:['alpha_med','sustained','flex'] },
        { id:'wz1321', name:'WZ-132-1', nation:'China', cls:'Light',
            role:'stealthy light with good gun',
            bullets:['Active or passive spots','Solid camo & DPM for a light','Avoid extended trades'],
            tags:['vision','mobility_high','flex'] },
        { id:'bz75', name:'BZ-75', nation:'China', cls:'Heavy',
            role:'rocket-boosted brawler',
            bullets:['Jet boost for entries','High alpha trades','Armor-reliant pushes'],
            tags:['alpha_high','frontline','mobility_med'] },
        { id:'wz1115a', name:'WZ-111 5A', nation:'China', cls:'Heavy',
            role:'mobile heavy trader',
            bullets:['Good mobility for heavy','Reliable trades','Pressure flanks'],
            tags:['alpha_med','mobility_med','frontline'] },
        { id:'wz113gft', name:'WZ-113G FT', nation:'China', cls:'TD',
            role:'alpha TD with armor',
            bullets:['Strong frontal profile','Punish peeks','Advance behind cover'],
            tags:['alpha_high','armor_high','frontline'] },

        // ‚Äî Czech ‚Äî
        { id:'tvp5051', name:'TVP T 50/51', nation:'Czech Republic', cls:'Medium',
            role:'high-tempo autoloader medium',
            bullets:['Fast clip, extreme mobility','Pick windows, then relocate','Avoid sustained trades'],
            tags:['burst','mobility_high','glass','flex'] },
        { id:'vz55', name:'Vz. 55', nation:'Czech Republic', cls:'Heavy',
            role:'flexible burst heavy with clip or single shot',
            bullets:['2-shot burst then fall back','Strong turret, hull-down','Good at relocating'],
            tags:['burst','mobility_med','turret_strong','flex'] },
        { id:'vz71', name:'Vz. 71 Tes√°k', nation:'Czech Republic', cls:'Light',
            role:'active light with vision pressure',
            bullets:['Scout aggressively when safe','Relocate constantly','Capitalize on map control'],
            tags:['mobility_high','vision','glass','flex'] },

        // ‚Äî Italy ‚Äî
        { id:'prog65', name:'Progetto M40 mod. 65', nation:'Italy', cls:'Medium',
            role:'autoreloader all-rounder',
            bullets:['Burst when opportunity arises','Single shot for consistency','Highly flexible'],
            tags:['burst','sustained','mobility_med','flex'] },
        { id:'rino', name:'Rinoceronte', nation:'Italy', cls:'Heavy',
            role:'turreted autoreloader heavy',
            bullets:['Use A/R windows for picks','Hull-down where possible','Don‚Äôt over-commit between shells'],
            tags:['burst','turret_strong','control'] },
        { id:'minotauro', name:'Controcarro 3 Minotauro', nation:'Italy', cls:'TD',
            role:'armored autoreloader TD',
            bullets:['Hull-down bunker','Punish with short bursts','Limited arcs ‚Äì pre-aim'],
            tags:['burst','armor_high','frontline'] },

        // ‚Äî Japan ‚Äî
        { id:'stb1', name:'STB-1', nation:'Japan', cls:'Medium',
            role:'hull-down DPM with hydropneumatics',
            bullets:['Show turret, hide hull','Apply constant pressure','Very map-dependent'],
            tags:['turret_strong','sustained','mobility_med','control'] },
        { id:'type5', name:'Type 5 Heavy', nation:'Japan', cls:'Heavy',
            role:'very large bunker-heavy',
            bullets:['Absorb and trade','Works best in corridors','Team anchor'],
            tags:['superheavy','armor_high','mobility_verylow','frontline'] },
        { id:'type71', name:'Type 71', nation:'Japan', cls:'Heavy',
            role:'modern hull-down heavy',
            bullets:['Use hydro suspension','Strong turret','Methodical pressure'],
            tags:['turret_strong','armor_high','frontline'] },
        { id:'hori3', name:'Ho-Ri 3', nation:'Japan', cls:'TD',
            role:'high-alpha turretless TD',
            bullets:['Punish peeks from range','Angle and pre-aim','Weak to flanks'],
            tags:['alpha_high','sniper'] },

        // ‚Äî Poland ‚Äî
        { id:'cs63', name:'CS-63', nation:'Poland', cls:'Medium',
            role:'turbo-boost flexible medium',
            bullets:['Use speed mode smartly','Take early positions','Mid-range support and flanks'],
            tags:['mobility_high','flex','sustained'] },
        { id:'60tp', name:'60TP Lewandowskiego', nation:'Poland', cls:'Heavy',
            role:'alpha-trading heavy',
            bullets:['Big hits around corners','Sidescrape when possible','Punish greed'],
            tags:['alpha_high','frontline','armor_high'] },
        { id:'nc70', name:'NC-70 B≈Çyskawica', nation:'Poland', cls:'TD',
            role:'alpha TD with mobility edge',
            bullets:['Ambush and push windows','Good pen and angles','Avoid overexposure'],
            tags:['alpha_high','mobility_med','frontline'] },

        // ‚Äî Sweden ‚Äî
        { id:'udes1516', name:'UDES 15/16', nation:'Sweden', cls:'Medium',
            role:'hull-down medium with good handling',
            bullets:['Use hydropneumatics','Positional play and consistency','Can switch flanks'],
            tags:['turret_strong','sustained','mobility_med','flex'] },
        { id:'kranvagn', name:'Kranvagn', nation:'Sweden', cls:'Heavy',
            role:'turreted autoloader heavy',
            bullets:['Hull-down trading','Short bursts, then cover','Control ridges'],
            tags:['burst','turret_strong','frontline'] },
        { id:'strv103b', name:'Strv 103B', nation:'Sweden', cls:'TD',
            role:'siege sniper',
            bullets:['Positional play and camouflage','Laser accuracy in siege mode','Stationary and team-dependent'],
            tags:['sniper','sustained','stationary','vision'] }
    ];

    function evaluate(answers){
        const pref = {
            mobility: 0,
            sustained: 0,
            burst: 0,
            presence: 0,
            indirect: 0,
            armor: 0,
            alpha: 0,
            vision: 0,
            flexibility: 0,
        };
        const a = (i)=>answers[i-1]===true;
        if(a(3)) pref.mobility+=2;
        if(a(6)) pref.mobility+=2;
        if(a(1)) pref.mobility-=1;
        if(a(4)) pref.mobility-=2;
        if(a(5)) pref.sustained+=1;
        if(a(7)) pref.vision+=1;
        if(a(8)) {pref.sustained+=1; pref.burst-=1;}

        if(a(9)) pref.burst+=2; else pref.sustained+=1;
        if(a(10)) pref.sustained+=2;
        if(a(11)) pref.sustained+=1; else pref.alpha+=1;
        if(a(12)) pref.burst-=1;
        if(a(13)) pref.alpha+=1;
        if(a(14)) pref.sustained+=1;
        if(a(15)) {pref.indirect+=1; pref.vision+=1;} else {pref.sustained+=1;}
        if(a(16)) pref.sustained+=1; else pref.burst+=1;
        if(a(17)) pref.presence+=2; else pref.indirect+=1;
        if(a(18)) pref.indirect+=1; else pref.presence+=1;
        if(a(19)) pref.presence+=1;
        if(a(20)) pref.presence+=1;
        if(a(21)) pref.presence+=1; else pref.indirect+=1;
        if(a(22)) pref.indirect+=2;
        if(a(23)) {pref.armor+=1; pref.presence+=1;}
        if(a(24)) {pref.presence+=1;}
        if(a(25)) {pref.armor+=1; pref.mobility-=1;}
        if(!a(26)) pref.sustained+=1;
        if(!a(27)) pref.armor+=1; else pref.mobility+=1;
        if(!a(28)) pref.alpha+=1;
        if(a(29)) {pref.presence+=1; pref.armor+=1;}
        if(a(30)) {pref.sustained+=1;} else {pref.burst+=1;}
        if(a(31)) {pref.alpha+=1; pref.burst+=1;}
        if(a(32)) {pref.flexibility+=1;} else {pref.sustained+=1;}
        if(a(33)) pref.flexibility+=2; else pref.sustained+=1;
        if(a(34)) pref.sustained+=1; else pref.flexibility+=1;
        if(a(35)) pref.flexibility+=2; else pref.sustained+=1;
        if(a(36)) pref.sustained+=1;
        if(a(37)) pref.flexibility+=1;
        if(a(38)) pref.flexibility+=0; else pref.sustained+=1;
        if(a(39)) pref.flexibility+=2; else pref.indirect+=1;
        if(a(40)) pref.indirect+=2; else pref.presence+=1;
        function scoreTank(t){
            let s=0; const tags=t.tags||[];
            if(tags.includes('mobility_high')) s+=pref.mobility>1?2:0;
            if(tags.includes('mobility_med')) s+=pref.mobility>=0?1:0;
            if(tags.includes('mobility_low')||tags.includes('mobility_verylow')) s+=(pref.mobility<0?2:0);

            if(tags.includes('sustained')) s+=pref.sustained;
            if(tags.includes('control')) s+=Math.max(0, Math.floor(pref.sustained/2));
            if(tags.includes('burst')||tags.includes('burst_light')) s+=pref.burst;

            if(tags.includes('frontline')) s+=pref.presence;
            if(tags.includes('vision')||tags.includes('sniper')) s+=pref.vision;

            if(tags.includes('armor_high')||tags.includes('superheavy')||tags.includes('turret_strong')) s+=pref.armor;
            if(tags.includes('glass')||tags.includes('glass_light')) s+= (pref.armor<0?2:0);
            if(tags.includes('armor_med')) s+=Math.max(0, Math.floor(pref.armor/2));

            if(tags.includes('alpha_high')||tags.includes('alpha_veryhigh')||tags.includes('alpha_med')) s+=pref.alpha;

            if(tags.includes('flex')||tags.includes('med_heavy')) s+=pref.flexibility;

            if(tags.includes('arty')||tags.includes('indirect')||tags.includes('stationary')) s+=pref.indirect;

            return s;
        }

        const tanksSrc = (window.I18N && I18N.tanks) ? I18N.tanks : TANKS;
        const scored = tanksSrc.map(t=>({t,score:scoreTank(t)})).sort((a,b)=>b.score-a.score);
        return {pref,scored};
    }

    // i18n loading
    let I18N = null;
    let currentLanguage = 'en';
    let LAST_ANSWERS = null; // Merkt sich aktuelle Antworten f√ºr Re-Render nach Sprachwechsel
    let LAST_RENDERED_IDS = null; // IDs der zuletzt gezeigten Tanks f√ºr sprachneutrales Re-Render
    async function loadLanguage(lang){
        const file = lang==='de' ? 'german.json' : 'english.json';
        try{
            const res = await fetch(file, {cache:'no-cache'});
            if(!res.ok) throw new Error('fetch failed');
            I18N = await res.json();
            currentLanguage = lang;

            // Verify translated data against defaults to avoid broken forms
            try{
                if(I18N.sections){
                    let secOk = true;
                    for(const [k, defArr] of Object.entries(SECTIONS)){
                        const arr = I18N.sections[k];
                        if(!Array.isArray(arr) || arr.length !== defArr.length){
                            console.error('i18n sections mismatch for', k);
                            secOk = false;
                        }
                    }
                    const extra = Object.keys(I18N.sections).filter(k=>!(k in SECTIONS));
                    if(extra.length){
                        console.error('i18n contains unknown sections:', extra.join(', '));
                        secOk = false;
                    }
                    if(!secOk) delete I18N.sections; // fall back to defaults
                }
                if(I18N.tanks){
                    const defIds = new Set(TANKS.map(t=>t.id));
                    let tankOk = I18N.tanks.length === TANKS.length;
                    if(tankOk){
                        for(const t of I18N.tanks){
                            if(!defIds.has(t.id)){ tankOk = false; break; }
                        }
                    }
                    if(!tankOk){
                        console.error('i18n tanks mismatch, using defaults');
                        delete I18N.tanks;
                    }
                }
            }catch(err){
                console.error('i18n validation failed', err);
            }
            // Sprache f√ºr kurze Zeit merken (12h TTL)
            try {
                localStorage.setItem('wot_lang', lang);
                localStorage.setItem('wot_lang_exp', String(Date.now() + 12*60*60*1000));
            } catch(e){ /* ignore storage errors */ }
        }catch(e){
            // Fallback: behalte bestehende EN-Texte
            I18N = I18N || {
                ui: {
                    pageTitle: document.title,
                    headerTitle: document.getElementById('appTitle')?.textContent || '',
                    classesPill: document.getElementById('classPill')?.textContent || '',
                    introText: document.getElementById('introText')?.textContent || '',
                    btnStart: document.getElementById('btnStart')?.textContent || 'Start questionnaire',
                    btnDemo: document.getElementById('btnDemo')?.textContent || 'Load sample answers',
                    btnReset: document.getElementById('btnReset')?.textContent || 'Reset',
                    btnShowResults: 'Show results',
                    resultsTitle: 'Your matching Tier 10 tanks',
                    roleLabel: 'Role',
                    tagsLabel: 'Tags',
                    whyNotTitle: 'Why not other classes?',
                    reasons: {
                        arty_less_presence: '<b>Artillery</b>: too indirect/team-dependent compared with your desire for visible presence.',
                        arty_ok: '<b>Artillery</b>: possible since you accept indirect impact, but the top matches lie elsewhere.',
                        superheavy_too_sluggish: '<b>Super-heavies (Maus/E 100/Type 71)</b>: too sluggish for your mobility/flex preference.',
                        superheavy_partly: '<b>Super-heavies</b>: partly suitable due to armor, but other options offer more output.',
                        stationary_tds_position_bound: '<b>Stationary TDs (Strv 103B/Grille 15)</b>: strong long-range impact but too position-bound for your playstyle.',
                        lights_too_indirect: '<b>Lights</b>: very mobile but too indirect (spot/assist) compared with your desire for direct damage.',
                        lights_possible: '<b>Lights</b>: possible, but other classes fit your preferences better.'
                    },
                    diagnosticsTitle: 'Diagnostics (top scores)',
                    scoreLabel: 'Score',
                    footer: document.querySelector('footer p')?.textContent || 'Single‚Äëfile app.',
                    yesLabel: 'Yes',
                    noLabel: 'No',
                    alertInternalError: 'Internal error at question {i}',
                    alertMissing: 'Please answer all questions. Missing: {i}',
                },
                sections: SECTIONS,
                tanks: TANKS
            };
        }
        applyTranslations();
    }
    function applyTranslations(){
        if(!I18N) return;
        document.documentElement.lang = currentLanguage==='de'?'de':'en';
        document.title = I18N.ui.pageTitle || document.title;
        const $ = (id)=>document.getElementById(id);
        const set = (id, val)=>{ const el=$(id); if(el && typeof val==='string') el.textContent=val; };
        set('appTitle', I18N.ui.headerTitle);
        set('classPill', I18N.ui.classesPill);
        set('introText', I18N.ui.introText);
        set('btnStart', I18N.ui.btnStart);
        set('btnDemo', I18N.ui.btnDemo);
        set('btnReset', I18N.ui.btnReset);
        const footerEl = document.querySelector('footer p'); if(footerEl) footerEl.id='footerText', footerEl.textContent=I18N.ui.footer;

        // Formulartexte aktualisieren, Antworten erhalten
        const formWrap = document.getElementById('formWrap');
        if(formWrap && formWrap.style.display !== 'none'){
            rebuildFormPreserveAnswers();
        }
        // Ergebnisse neu rendern: bevorzugt exakt dieselben Tanks, sonst anhand Antworten
        const resultBox = document.getElementById('result');
        if(resultBox && resultBox.style.display !== 'none'){
            const tanksSrc = (I18N && I18N.tanks) ? I18N.tanks : TANKS;
            if(Array.isArray(LAST_RENDERED_IDS) && LAST_RENDERED_IDS.length){
                const byId = new Map(tanksSrc.map(t=>[t.id, t]));
                const tanks = LAST_RENDERED_IDS.map(id=>byId.get(id)).filter(Boolean);
                let pref=null, scored=null;
                if(Array.isArray(LAST_ANSWERS)){
                    const r = evaluate(LAST_ANSWERS);
                    pref = r.pref; scored = r.scored;
                }
                renderResult(tanks, pref, scored||[]);
            } else if(Array.isArray(LAST_ANSWERS)){
                const {pref,scored} = evaluate(LAST_ANSWERS);
                const top = scored.slice(0,6);
                const picked=[];
                for(const s of top){
                    if(picked.length>=3) break;
                    if(!picked.find(p=>p.t.id===s.t.id)) picked.push(s);
                }
                renderResult(picked.map(x=>x.t), pref, scored);
            }
        }
    }
    document.addEventListener('DOMContentLoaded', ()=>{
        const btnDE=document.getElementById('btnLangDE');
        const btnEN=document.getElementById('btnLangEN');
        if(btnDE) btnDE.addEventListener('click', ()=>loadLanguage('de'));
        if(btnEN) btnEN.addEventListener('click', ()=>loadLanguage('en'));
        // Gespeicherte Sprache mit TTL laden
        let initial = 'en';
        try{
            const lang = localStorage.getItem('wot_lang');
            const exp = Number(localStorage.getItem('wot_lang_exp')||0);
            if(lang && Date.now() < exp) initial = lang;
        }catch(e){}
        loadLanguage(initial);
    });

    function getSectionsSrc(){
        return (window.I18N && I18N.sections) ? I18N.sections : SECTIONS;
    }
    function getTotalQuestions(){
        const secs = getSectionsSrc();
        let total = 0;
        for(const qs of Object.values(secs)) total += (qs?.length||0);
        return total;
    }
    function getCurrentAnswersFromDOM(){
        const total = getTotalQuestions();
        const answers = [];
        for(let i=1;i<=total;i++){
            const y=document.getElementById('q'+i+'y');
            const n=document.getElementById('q'+i+'n');
            if(!y||!n){ answers.push(null); continue; }
            if(y.checked) answers.push(true);
            else if(n.checked) answers.push(false);
            else answers.push(null);
        }
        return answers;
    }
    function buildForm(answersPreset){
        const wrap=document.getElementById('formWrap');
        wrap.innerHTML='';
        wrap.style.display='grid';
        let idx=0; const form=document.createElement('form');
        for(const [section,qs] of Object.entries(getSectionsSrc())){
            const sec=document.createElement('div'); sec.style.marginBottom='1em';
            sec.className='card';
            const h=document.createElement('div');h.className='section-title';h.textContent=section;sec.appendChild(h);
            qs.forEach(q=>{
                idx++; const row=document.createElement('div');row.className='q';
                const lab=document.createElement('label');lab.setAttribute('for','q'+idx);lab.textContent=q;row.appendChild(lab);
                const yn=document.createElement('div');yn.className='yesno';
                yn.innerHTML=`
          <input type="radio" name="q${idx}" id="q${idx}y" value="yes"><label for="q${idx}y">${(I18N&&I18N.ui&&I18N.ui.yesLabel)||'Yes'}</label>
          <input type="radio" name="q${idx}" id="q${idx}n" value="no"><label for="q${idx}n">${(I18N&&I18N.ui&&I18N.ui.noLabel)||'No'}</label>
        `;
                row.appendChild(yn);
                sec.appendChild(row);
            });
            form.appendChild(sec);
        }
        const actions=document.createElement('div');actions.className='actions';
        const btn=document.createElement('button');btn.type='button';btn.className='primary';btn.textContent=(I18N&&I18N.ui&&I18N.ui.btnShowResults)||'Show results';btn.onclick=submit;
        actions.appendChild(btn);
        const reset=document.createElement('button');reset.type='button';reset.textContent=(I18N&&I18N.ui&&I18N.ui.btnReset)||'Reset';reset.onclick=resetAll;actions.appendChild(reset);
        form.appendChild(actions);
        wrap.appendChild(form);

        // Antworten nach dem Einf√ºgen der Form wiederherstellen
        if(Array.isArray(answersPreset)){
            for(let i=0;i<answersPreset.length;i++){
                const val = answersPreset[i];
                if(typeof val === 'boolean'){
                    const idx1 = i+1;
                    const y=document.getElementById('q'+idx1+'y');
                    const n=document.getElementById('q'+idx1+'n');
                    if(y && n){ if(val===true) y.checked = true; else n.checked = true; }
                }
            }
        }
    }
    function rebuildFormPreserveAnswers(){
        const answers = getCurrentAnswersFromDOM();
        buildForm(answers);
    }
    function start(){
        buildForm(null);
        document.getElementById('intro').style.display='none';
    }

    function submit(){
        const total = getTotalQuestions();
        const answers=[];
        for(let i=1;i<=total;i++){
            const y=document.getElementById('q'+i+'y');
            const n=document.getElementById('q'+i+'n');
            if(!y||!n){const msg=(I18N&&I18N.ui&&I18N.ui.alertInternalError)||'Internal error at question {i}';alert(msg.replace('{i}',String(i)));return}
            if(!y.checked && !n.checked){const msg=(I18N&&I18N.ui&&I18N.ui.alertMissing)||'Please answer all questions. Missing: {i}';alert(msg.replace('{i}',String(i)));return}
            answers.push(!!y.checked);
        }
        LAST_ANSWERS = answers.slice();

        const {pref,scored}=evaluate(answers);
        const top = scored.slice(0,6);
        const picked=[];
        for(const s of top){
            if(picked.length>=3) break;
            if(!picked.find(p=>p.t.id===s.t.id)) picked.push(s);
        }

        renderResult(picked.map(x=>x.t), pref, scored);
    }

    function renderResult(tanks, pref, scored){
        const box=document.getElementById('result');
        box.style.display='block';
        box.innerHTML='';

        const h=document.createElement('h2');h.textContent=(I18N&&I18N.ui&&I18N.ui.resultsTitle)||'Your matching Tier 10 tanks';box.appendChild(h);

        tanks.slice(0,3).forEach(t=>{
            const div=document.createElement('div');div.className='recommendation';
            const roleLabel=(I18N&&I18N.ui&&I18N.ui.roleLabel)||'Role';
            const tagsLabel=(I18N&&I18N.ui&&I18N.ui.tagsLabel)||'Tags';
            div.innerHTML=`
        <div class="rec-title">${t.name} (${t.nation}, ${t.cls})</div>
        <div class="muted">${roleLabel}: ${t.role}</div>
        <ul class="bullets">${t.bullets.map(b=>`<li>${b}</li>`).join('')}</ul>
        <div class="tag muted">${tagsLabel}: ${t.tags.join(', ')}</div>
      `;
            box.appendChild(div);
        });

        // Merke IDs der angezeigten Tanks f√ºr erneutes Rendern bei Sprachwechsel
        LAST_RENDERED_IDS = tanks.slice(0,3).map(t=>t.id);

        const other = document.createElement('div'); other.style.marginTop='14px'; other.style.marginBottom='10px';
        const sum=document.createElement('details');
        sum.innerHTML=`<summary>${(I18N&&I18N.ui&&I18N.ui.whyNotTitle)||'Why not other classes?'}</summary>`;
        const reasons=[];
        const R=I18N&&I18N.ui&&I18N.ui.reasons;
        if(pref.indirect < pref.presence){
            reasons.push((R&&R.arty_less_presence)||'<b>Artillery</b>: too indirect/team-dependent compared with your desire for visible presence.');
        } else {
            reasons.push((R&&R.arty_ok)||'<b>Artillery</b>: possible since you accept indirect impact, but the top matches lie elsewhere.');
        }
        if(pref.mobility > 0 && pref.flexibility > 0){
            reasons.push((R&&R.superheavy_too_sluggish)||'<b>Super-heavies (Maus/E 100/Type 71)</b>: too sluggish for your mobility/flex preference.');
        } else if(pref.armor>0){
            reasons.push((R&&R.superheavy_partly)||'<b>Super-heavies</b>: partly suitable due to armor, but other options offer more output.');
        }
        if(pref.vision>0){
            reasons.push((R&&R.stationary_tds_position_bound)||'<b>Stationary TDs (Strv 103B/Grille 15)</b>: strong long-range impact but too position-bound for your playstyle.');
        }
        if(pref.presence>pref.indirect){
            reasons.push((R&&R.lights_too_indirect)||'<b>Lights</b>: very mobile but too indirect (spot/assist) compared with your desire for direct damage.');
        } else {
            reasons.push((R&&R.lights_possible)||'<b>Lights</b>: possible, but other classes fit your preferences better.');
        }

        sum.insertAdjacentHTML('beforeend', `<div style="margin-top:8px">${reasons.map(r=>`<div>‚Ä¢ ${r}</div>`).join('')}</div>`);
        other.appendChild(sum);

        const dbg=document.createElement('details');
        dbg.innerHTML=`<summary>${(I18N&&I18N.ui&&I18N.ui.diagnosticsTitle)||'Diagnostics (top scores)'}</summary>`;
        const scoreLabel=(I18N&&I18N.ui&&I18N.ui.scoreLabel)||'Score';
        const list = scored.slice(0,8).map(s=>`<div>‚Ä¢ ${s.t.name} ‚Äì ${scoreLabel} ${s.score}</div>`).join('');
        dbg.insertAdjacentHTML('beforeend', `<div class="muted" style="margin-top:6px">${list}</div>`);

        box.appendChild(other);
        box.appendChild(dbg);
        window.scrollTo({top:box.offsetTop-10,behavior:'smooth'});
    }

    function resetAll(){
        document.getElementById('intro').style.display='block';
        document.getElementById('formWrap').style.display='none';
        document.getElementById('formWrap').innerHTML='';
        document.getElementById('result').style.display='none';
        document.getElementById('result').innerHTML='';
        LAST_ANSWERS = null;
        LAST_RENDERED_IDS = null;
    }

    function demoFill(){
        start();
        const total = getTotalQuestions();
        const yes=[3,6,9,10,13,16,17,19,20,21,23,24,27,29,31,33,35,36,37,39,40];
        for(let i=1;i<=total;i++){
            const y=document.getElementById('q'+i+'y');
            const n=document.getElementById('q'+i+'n');
            if(!y||!n) continue;
            if(yes.includes(i)) y.checked=true; else n.checked=true;
        }
    }
</script>
</body>
</html>
